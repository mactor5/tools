name: Verify Gemini Key

on:
  schedule:
    # åŒ—äº¬æ—¶é—´æ¯å¤© 16:00 Gemini Key åˆ·æ–°é¢åº¦
    - cron: '10 0 * * *'
    - cron: '10 8 * * *'  
    - cron: '10 16 * * *' 
  workflow_dispatch:

jobs:
  Verify-Flash:
    runs-on: ubuntu-latest
    steps:
      - name: è¿å‡ºä»£ç 
        uses: actions/checkout@v3

      - name: ä½¿ç”¨FLASHæ¨¡å‹æ£€æµ‹
        run: |
          wget https://github.com/DeepSaek/Repo/raw/refs/heads/main/Verify%20Gemini%20Key/key.zip
          unzip -P ${{ secrets.ZIPASS }} key.zip
          wget https://github.com/DeepSaek/Repo/raw/refs/heads/main/Verify%20Gemini%20Key/checkerflash
          chmod a+x checkerflash
          ./checkerflash -i gemini.txt

      - name: å¤„ç†ç»“æœ
        run: |
          TS=$(date +%s)
          echo $(TZ="Asia/Shanghai" date -d "@$TS" "+%Y%m%d%H%M%S") > time.txt
          echo $(TZ="Asia/Shanghai" date -d "@$TS" "+%Y-%m-%d %H:%M:%S") > new_time.txt
          mv freekey.txt freekey-$(cat time.txt).txt
          mv paidkey.txt paidkey-$(cat time.txt).txt
          echo "FREE_COUNT=$(wc -l < freekey-$(cat time.txt).txt)" >> $GITHUB_ENV
          echo "PAID_COUNT=$(wc -l < paidkey-$(cat time.txt).txt)" >> $GITHUB_ENV
          echo "MODEL_FULL_NAME=Gemini 2.5 Flash" >> $GITHUB_ENV

      - name: å‘é€ç»“æœ
        run: |
          FREE_FILE="freekey-$(cat time.txt).txt"
          PAID_FILE="paidkey-$(cat time.txt).txt"
          if [ ! -s "$FREE_FILE" ]; then
            echo "æ­¤ç±»åˆ«æ— æœ‰æ•ˆçš„å¯†é’¥ã€‚" > "$FREE_FILE"
          fi
          if [ ! -s "$PAID_FILE" ]; then
            echo "æ­¤ç±»åˆ«æ— æœ‰æ•ˆçš„å¯†é’¥ã€‚" > "$PAID_FILE"
          fi
          COMPLETION_TIME=$(cat new_time.txt)
          curl -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMediaGroup" \
            -F chat_id="${{ secrets.TELEGRAM_TO }}" \
            -F media='[
                {
                    "type": "document",
                    "media": "attach://file1"
                },
                {
                    "type": "document",
                    "media": "attach://file2",
                    "caption": "<b>ğŸš€ Geminiå¯†é’¥éªŒè¯å®Œæˆ</b>\n\n<b>æµ‹è¯•æ¨¡å‹:</b> ${{ env.MODEL_FULL_NAME }}\n<b>å…è´¹å¯†é’¥:</b> ${{ env.FREE_COUNT }} ä¸ª\n<b>ä»˜è´¹å¯†é’¥:</b> ${{ env.PAID_COUNT }} ä¸ª\n\n<b>å®Œæˆæ—¶é—´:</b> '"$COMPLETION_TIME"'",
                    "parse_mode": "HTML"
                }
            ]' \
            -F file1=@"$FREE_FILE" \
            -F file2=@"$PAID_FILE"

  Verify-Pro:
    runs-on: ubuntu-latest
    steps:
      - name: è¿å‡ºä»£ç 
        uses: actions/checkout@v3

      - name: ä½¿ç”¨PROæ¨¡å‹æ£€æµ‹
        run: |
          wget https://github.com/DeepSaek/Repo/raw/refs/heads/main/Verify%20Gemini%20Key/key.zip
          unzip -P ${{ secrets.ZIPASS }} key.zip
          wget https://github.com/DeepSaek/Repo/raw/refs/heads/main/Verify%20Gemini%20Key/checkerpro
          chmod a+x checkerpro
          ./checkerpro -i gemini.txt -r 2

      - name: å¤„ç†ç»“æœ
        run: |
          TS=$(date +%s)
          echo $(TZ="Asia/Shanghai" date -d "@$TS" "+%Y%m%d%H%M%S") > time.txt
          echo $(TZ="Asia/Shanghai" date -d "@$TS" "+%Y-%m-%d %H:%M:%S") > new_time.txt
          mv freekey.txt freekey-$(cat time.txt).txt
          mv paidkey.txt paidkey-$(cat time.txt).txt
          echo "FREE_COUNT=$(wc -l < freekey-$(cat time.txt).txt)" >> $GITHUB_ENV
          echo "PAID_COUNT=$(wc -l < paidkey-$(cat time.txt).txt)" >> $GITHUB_ENV
          echo "MODEL_FULL_NAME=Gemini 2.5 Pro" >> $GITHUB_ENV

      - name: å‘é€ç»“æœ
        run: |
          FREE_FILE="freekey-$(cat time.txt).txt"
          PAID_FILE="paidkey-$(cat time.txt).txt"
          if [ ! -s "$FREE_FILE" ]; then
            echo "æ­¤ç±»åˆ«æ— æœ‰æ•ˆçš„å¯†é’¥ã€‚" > "$FREE_FILE"
          fi
          if [ ! -s "$PAID_FILE" ]; then
            echo "æ­¤ç±»åˆ«æ— æœ‰æ•ˆçš„å¯†é’¥ã€‚" > "$PAID_FILE"
          fi
          COMPLETION_TIME=$(cat new_time.txt)
          curl -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMediaGroup" \
            -F chat_id="${{ secrets.TELEGRAM_TO }}" \
            -F media='[
                {
                    "type": "document",
                    "media": "attach://file1"
                },
                {
                    "type": "document",
                    "media": "attach://file2",
                    "caption": "<b>ğŸš€ Geminiå¯†é’¥éªŒè¯å®Œæˆ</b>\n\n<b>æµ‹è¯•æ¨¡å‹:</b> ${{ env.MODEL_FULL_NAME }}\n<b>å…è´¹å¯†é’¥:</b> ${{ env.FREE_COUNT }} ä¸ª\n<b>ä»˜è´¹å¯†é’¥:</b> ${{ env.PAID_COUNT }} ä¸ª\n\n<b>å®Œæˆæ—¶é—´:</b> '"$COMPLETION_TIME"'",
                    "parse_mode": "HTML"
                }
            ]' \
            -F file1=@"$FREE_FILE" \
            -F file2=@"$PAID_FILE"